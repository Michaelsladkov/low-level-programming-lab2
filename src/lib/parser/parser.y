/*
    Parser for my Cypher-based querry language
*/
%require "3.2"
%language "c++"

%skeleton "lalr1.cc"

%code requires 
{
#include <string>
}

%union
{
    const char  *name;
    std::string *string;
    INode       *iNode;
    ReturnList  *returnList;
    Value       *Value;
    int         integer;
    float       real;
    bool        boolean;
}

%token
    MATCH_KEYWORD
    WHERE_KEYWORD
    RETURN_KEYWORD
    CREATE_KEYWORD
    DELETE_KEYWORD
    SET_KEYWORD
    AND_KEYMORD
    OR_KEYWORD
    NOT_KEYWORD
    GREATER_CMP
    GREATER_OR_EUQAL_CMP
    LESS_CMP
    LESS_OR_EQUAL_CMP
    EQUAL_CMP
    CONTAINS_OP
    ASSIGNMENT
    DASH
    RIGHT_ARROW
    LEFT_ARROW
    DOUBLE_DASH
    COLON
    SCOLON
    PERIOD
    COMMA
    LPAR
    RPAR
    LBRACKET
    RBRACKET
    LBRACE
    RBRACE
    END_OF_FILE
;

%token <string>  STRING_LITERAL
%token <integer> INT_LITERAL
%token <real>    FLOAT_LITERAL
%token <boolean> BOOL_LITERAL
%token <name>    NAME

%nterm <iNode>       REQUEST
%nterm <iNode>       REQUEST_B
%nterm <iNode>       MATCH_QUERRY
%nterm <iNode>       ANY_VARIABLE_MATCH
%nterm <iNode>       VARIABLE_MATCH
%nterm <iNode>       ANY_RELATION_MATCH
%nterm <iNode>       RELATION_MATCH
%nterm <iNode>       MATCH_QUERRY
%nterm <iNode>       RETURN_EXPRESSION
%nterm <returnList>  RETURN_LIST
%nterm <Value>       VALUE
%nterm <iNode>       CREATE_QUERRY
%nterm <iNode>       SET_EXPRESSION
%nterm <iNode>       DELETE_EXPRESSION
%nterm <iNode>       FILTER
%nterm <iNode>       FILTER_CHAIN
%nterm <iNode>       ATTRIBUTE_LIST
%nterm <iNode>       ATTRIBUTE

%left OR_KEYWORD
%left AND_KEYMORD
%left NOT_KEYWORD

%start REQUEST

%%
REQUEST: REQUEST_B SCOLON
       | REQUEST_B END_OF_FILE

REQUEST_B: MATCH_QUERRY
         | REQUEST_B FILTER_CHAIN
         | REQUEST_B SET_EXPRESSION
         | REQUEST_B CREATE_QUERRY
         | REQUEST_B DELETE_EXPRESSION
         | REQUEST_B RETURN_EXPRESSION
;

MATCH_QUERRY: MATCH_KEYWORD VARIABLE_MATCH
            | MATCH_KEYWORD VARIABLE_MATCH RELATION_MATCH VARIABLE_MATCH
            | MATCH_KEYWORD VARIABLE_MATCH RELATION_MATCH ANY_VARIABLE_MATCH
            | MATCH_KEYWORD VARIABLE_MATCH ANY_RELATION_MATCH ANY_VARIABLE_MATCH
            | MATCH_KEYWORD VARIABLE_MATCH ANY_RELATION_MATCH VARIABLE_MATCH
;

VARIABLE_MATCH: LPAR NAME COLON NAME FILTER_CHAIN RPAR
              | LPAR NAME COLON NAME LBRACE ATTRIBUTE_LIST RBRACE RPAR
;

ANY_VARIABLE_MATCH: LPAR NAME RPAR
;

RELATION_MATCH: DASH LBRACKET NAME COLON NAME RBRACKET RIGHT_ARROW
              | LEFT_ARROW LBRACKET NAME COLON NAME RBRACKET DASH
;

ANY_RELATION_MATCH: DOUBLE_DASH
;

FILTER_CHAIN: WHERE_KEYWORD FILTER
            | WHERE_KEYWORD NOT_KEYWORD FILTER
            | FILTER_CHAIN OR_KEYWORD FILTER
            | FILTER_CHAIN AND_KEYMORD FILTER_CHAIN
            | FILTER_CHAIN NOT_KEYWORD FILTER
;

FILTER: VALUE LESS_CMP VALUE
      | VALUE LESS_OR_EQUAL_CMP VALUE
      | VALUE GREATER_CMP VALUE
      | VALUE GREATER_OR_EUQAL_CMP VALUE
      | VALUE EQUAL_CMP VALUE
      | VALUE CONTAINS_OP VALUE
;

SET_EXPRESSION: SET_KEYWORD NAME PERIOD NAME ASSIGNMENT VALUE
;

DELETE_EXPRESSION: DELETE_KEYWORD NAME
;

RETURN_EXPRESSION: RETURN_EXPRESSION COMMA VALUE
                 | RETURN_KEYWORD VALUE

ATTRIBUTE_LIST: NAME PERIOD NAME COLON VALUE COMMA ATTRIBUTE_LIST
              | NAME PERIOD NAME COLON VALUE

CREATE_QUERRY: CREATE_KEYWORD VARIABLE_MATCH
             | CREATE_KEYWORD VARIABLE_MATCH RELATION_MATCH VARIABLE_MATCH

VALUE: NAME
     | BOOL_LITERAL
     | INT_LITERAL
     | FLOAT_LITERAL
     | STRING_LITERAL
     | NAME PERIOD NAME
;
%%
